<div class="text-center">
	<h1>Corporate Action Lifecycle</h1>
</div>

<div id="timeline" class="outlined"></div>

<div data-bind="foreach: processes" class="processes-container outlined">
	<div data-bind="attr: { id: id }" class="processes-item process-container outlined">

		<h4 data-bind="text: title" class="justified"></h4>

		<div class="process-item justified">
			<div class="text-bold">Target date:</div>
			<ul data-bind="foreach: targetDateItems()">
				<li data-bind="text: $data"></li>
			</ul>
		</div>

		<div class="process-item justified">
			<div class="text-bold">Critical date:</div>
			<ul data-bind="foreach: criticalDateItems()">
				<li data-bind="text: $data"></li>
			</ul>
		</div>
	</div>
</div>

<script type="text/javascript">

	$(function () {
		var notif = $.connection.NotificationHub;

		notif.client.updateProcess = function (data) {
			var process = ko.utils.arrayFirst(viewModel.processes(), function (proc) {
				return proc.id === data.id;
			});

			if (process) {
				viewModel.processes.replace(process, new Process(data.id, data.title, data.targetDateItems, data.criticalDateItems));
			}
		};

		$.connection.hub.start();
	}());

	function Process(id, title, targetDateItems, criticalDateItems) {
		this.id = id;
		this.title = title;
		this.targetDateItems = ko.observableArray(targetDateItems);
		this.criticalDateItems = ko.observableArray(criticalDateItems);
	}

	function AppViewModel() {
		this.processes = ko.observableArray();
	}

	var viewModel = new AppViewModel();
	viewModel.processes([
		new Process("scrub", "CA Scrubbing", [], []),
		new Process("notif", "Notification", [], []),
		new Process("respo", "Response", [], []),
		new Process("instr", "Instruction", [], []),
		new Process("payme", "Payment", [], [])
	]);

	ko.applyBindings(viewModel);

	var container = document.getElementById("timeline");
	var data = [];
	var options = {};
	var timeline = new vis.Timeline(container, data, options);
</script>
